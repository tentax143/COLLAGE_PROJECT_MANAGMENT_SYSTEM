{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review 3 Mark Entry</title>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        .vertical-nav {
            min-width: 17rem;
            width: 17rem;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.4s;
        }
        .page-content {
            width: calc(100% - 17rem);
            margin-left: 17rem;
            transition: all 0.4s;
        }
        .nav-link {
            font-weight: 500;
            color: #333;
        }
        .nav-link:hover {
            background: #f3f2f2;
        }
        .text-primary {
            color: #7579e7 !important;
        }
        @media (max-width: 768px) {
            .vertical-nav {
                margin-left: -17rem;
            }
            .vertical-nav.active {
                margin-left: 0;
            }
            .page-content {
                width: 100%;
                margin: 0;
            }
            .page-content.active {
                margin-left: 17rem;
                width: calc(100% - 17rem);
            }
        }
        .separator {
            margin: 3rem 0;
            border-bottom: 1px dashed #fff;
        }
        .text-uppercase {
            letter-spacing: 0.1em;
        }
        .text-gray {
            color: #aaa;
        }
        .nav-link {
            text-transform: capitalize;
        }
        .nav-link:hover {
            background: #f3f2f2;
        }
        .text-primary {
            color: #7579e7 !important;
        }
        .btn-primary {
            background-color: #7579e7;
            border-color: #7579e7;
        }
        .btn-primary:hover {
            background-color: #6064cf;
            border-color: #6064cf;
        }
        .role-btn {
            margin: 5px;
            padding: 10px 20px;
        }
        .role-btn.active {
            background-color: #6064cf;
            border-color: #6064cf;
        }
        .table-container {
            display: none;
        }
        .table-container.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Vertical navbar -->
    <div class="vertical-nav bg-white" id="sidebar">
        <div class="py-4 px-3 mb-4 bg-light">
            <div class="media d-flex align-items-center">
                <div class="media-body">
                    <h4 class="m-0">{{ faculty_name }}</h4>
                    <p class="font-weight-normal text-muted mb-0">{{ department }}</p>
                    <p class="font-weight-normal text-muted mb-0">{{ role }}</p>
                </div>
            </div>
        </div>

        <p class="text-gray font-weight-bold text-uppercase px-3 small pb-4 mb-0">Navigation</p>

        <ul class="nav flex-column bg-white mb-0">
            <li class="nav-item">
                <a href="{% url 'view_guide_detail' %}" class="nav-link text-dark">
                    View Guide Detail
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'allocate_committee' %}" class="nav-link text-dark">
                    Allocate Committee Members
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link text-dark">
                    Review Mark Entry
                </a>
            </li>
        </ul>
    </div>
    <!-- End vertical navbar -->

    <!-- Page content holder -->
    <div class="page-content p-5" id="content">
        <!-- Content -->
        <h2 class="display-4 text-white">Review 3 Mark Entry</h2>
        <div class="separator"></div>

        <div class="role-selection text-center mb-4">
            <button class="btn btn-primary role-btn" data-role="guide">Guide</button>
            <button class="btn btn-primary role-btn" data-role="reviewer">Reviewer</button>
        </div>

        <!-- Guide Table -->
        <div id="guideTable" class="table-container">
            <h3>Students Pending Mark Entry (As Guide)</h3>
            {% if guide_students %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="thead-dark">
                        <tr>
                            <th>Student Name</th>
                            <th>Registration Number</th>
                            <th>Project Title</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for student in guide_students %}
                        <tr>
                            <td>{{ student.student_name }}</td>
                            <td>{{ student.reg_no }}</td>
                            <td>{{ student.project_title }}</td>
                            <td>
                                <button class="btn btn-primary enter-marks-btn" 
                                        data-student-name="{{ student.student_name }}"
                                        data-reg-no="{{ student.reg_no }}"
                                        data-semester="{{ student.semester }}"
                                        data-course-code="{{ student.course_code }}"
                                        data-reviewer-type="guide">
                                    Enter Marks
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p>No students pending mark entry as guide.</p>
            {% endif %}
        </div>

        <!-- Reviewer Table -->
        <div id="reviewerTable" class="table-container">
            <h3>Students Pending Mark Entry (As Reviewer)</h3>
            {% if reviewer_students %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="thead-dark">
                        <tr>
                            <th>Student Name</th>
                            <th>Registration Number</th>
                            <th>Project Title</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for student in reviewer_students %}
                        <tr>
                            <td>{{ student.student_name }}</td>
                            <td>{{ student.reg_no }}</td>
                            <td>{{ student.project_title }}</td>
                            <td>
                                <button class="btn btn-primary enter-marks-btn"
                                        data-student-name="{{ student.student_name }}"
                                        data-reg-no="{{ student.reg_no }}"
                                        data-semester="{{ student.semester }}"
                                        data-course-code="{{ student.course_code }}"
                                        data-reviewer-type="reviewer">
                                    Enter Marks
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p>No students pending mark entry as reviewer.</p>
            {% endif %}
        </div>

        <!-- Mark Entry Modal -->
        {% include 'faculty/review/mark_entry_form.html' with form_action="review3_markentry" review_number=3 %}
    </div>

    <script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <script>
        $(document).ready(function() {
            // Initially hide both tables
            $('.table-container').hide();

            // Role button click handler
            $('.role-btn').click(function() {
                $('.role-btn').removeClass('active');
                $(this).addClass('active');
                
                const role = $(this).data('role');
                $('.table-container').hide();
                
                if (role === 'guide') {
                    $('#guideTable').show();
                } else if (role === 'reviewer') {
                    $('#reviewerTable').show();
                }
            });

            // Enter marks button click handler
            $('.enter-marks-btn').click(function() {
                const studentName = $(this).data('student-name');
                const regNo = $(this).data('reg-no');
                const semester = $(this).data('semester');
                const courseCode = $(this).data('course-code');
                const reviewerType = $(this).data('reviewer-type');

                $('#studentNameInput').val(studentName);
                $('#regNoInput').val(regNo);
                $('#semesterInput').val(semester);
                $('#courseCodeInput').val(courseCode);
                $('#reviewerTypeInput').val(reviewerType);

                $('#markEntryModal').modal('show');
            });
        });
    </script>
</body>
</html>